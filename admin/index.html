<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&family=Zen+Maru+Gothic:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../src/admin/style.css" />
    <script>
      ;(() => {
        const CACHE_KEY = 'oisoya_review_config_cache'
        const ensureLink = (rel) => {
          const existing = document.querySelector(`link[rel="${rel}"]`)
          if (existing) return existing
          const link = document.createElement('link')
          link.setAttribute('rel', rel)
          document.head.appendChild(link)
          return link
        }
        const applyIcon = (href) => {
          if (!href) return
          ensureLink('icon').setAttribute('href', href)
          ensureLink('shortcut icon').setAttribute('href', href)
          ensureLink('apple-touch-icon').setAttribute('href', href)
        }
        try {
          const raw = window.localStorage.getItem(CACHE_KEY)
          if (!raw) return
          const cached = JSON.parse(raw)
          const branding = cached?.branding || {}
          const icon = branding.logoDataUrl || branding.faviconDataUrl || ''
          if (icon) {
            applyIcon(icon)
          }
        } catch {
          // noop
        }
      })()
    </script>
    <title>adminページ</title>
  </head>
  <body>
    <div id="admin-app" data-app-role="admin">
      <noscript>
        <p style="padding:1rem; text-align:center;">JavaScriptを有効にしてご利用ください。</p>
      </noscript>
      <main class="admin">
        <header class="admin__header">
          <p class="admin__badge">管理ページ</p>
          <h1 class="admin__title">adminページ</h1>
          <p class="admin__lead"><a href="/user/">ユーザー設定ページはこちら</a></p>
        </header>
        <div class="admin__menu" data-role="tab-menu-container">
          <button
            type="button"
            class="admin__menu-trigger"
            data-role="tab-menu-trigger"
            aria-expanded="false"
            aria-controls="admin-tab-menu"
            aria-label="メニュー"
          >
            <span class="sr-only">メニュー</span>
            <span class="admin__menu-trigger-icon" aria-hidden="true">≡</span>
          </button>
          <div class="admin__menu-panel" id="admin-tab-menu" data-role="tab-menu" aria-hidden="true">
            <nav class="admin__tabs" aria-label="設定メニュー">
              <button type="button" class="admin__tab is-active" data-tab-target="comm">通信設定</button>
              <button type="button" class="admin__tab" data-tab-target="ai-settings">AI設定</button>
              <button type="button" class="admin__tab" data-tab-target="landing">トップページ</button>
              <button type="button" class="admin__tab" data-tab-target="user-data">ユーザーデータ</button>
              <button type="button" class="admin__tab" data-tab-target="links">リンク先設定</button>
              <button type="button" class="admin__tab" data-tab-target="branding">ロゴ設定</button>
              <button type="button" class="admin__tab" data-tab-target="developer">開発者</button>
            </nav>
          </div>
        </div>
        <form id="config-form" class="admin__form">
          <section class="admin__panel is-active" data-tab-panel="comm">
            <section class="admin__card admin__card--results">
              <h2>プロンプト設問送信App</h2>
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">送信先API(URL)</span>
                  <input
                    type="url"
                    name="surveyEndpointUrl"
                    placeholder="https://script.google.com/macros/s/.../exec"
                    autocomplete="off"
                  />
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">APIキー（任意）</span>
                  <input type="text" name="surveyApiKey" placeholder="例: Bearer 用シークレット" autocomplete="off" />
                </label>
              </div>
            </section>
            <section class="admin__card admin__card--results">
              <h2>設問回答保存先</h2>
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">スプレッドシートURL</span>
                  <input
                    type="url"
                    name="surveySpreadsheetUrl"
                    placeholder="https://docs.google.com/spreadsheets/d/..."
                    autocomplete="off"
                  />
                </label>
              </div>
            </section>
            <section class="admin__card admin__card--results">
              <h2>回答データ読み取り</h2>
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">保存GAS URL</span>
                  <input
                    type="url"
                    name="prompt_page1_gasUrl"
                    placeholder="https://script.google.com/macros/s/.../exec"
                    autocomplete="off"
                  />
                </label>
              </div>
            </section>
          </section>
          <section class="admin__panel" data-tab-panel="user-data">
            <section class="admin__card">
              <h2>ユーザーデータ</h2>
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">保存先スプレッドシートURL</span>
                  <input
                    type="url"
                    name="userDataSpreadsheetUrl"
                    placeholder="https://docs.google.com/spreadsheets/d/..."
                    autocomplete="off"
                  />
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">保存GAS URL</span>
                  <input
                    type="url"
                    name="userDataSubmitGasUrl"
                    placeholder="https://script.google.com/macros/s/.../exec"
                    autocomplete="off"
                  />
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">読み取りGAS URL</span>
                  <input
                    type="url"
                    name="userDataReadGasUrl"
                    placeholder="https://script.google.com/macros/s/.../exec"
                    autocomplete="off"
                  />
                </label>
              </div>
            </section>
          </section>
          <section class="admin__panel" data-tab-panel="ai-settings">
            <section class="admin__card">
              <h2>LMM設定</h2>
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">モデル名</span>
                  <input
                    type="text"
                    name="model"
                    placeholder="例: gemini-1.5-flash-latest"
                    autocomplete="off"
                  />
                  <span class="admin__field-hint">使用するGeminiモデルを指定します。未入力の場合はデフォルトモデルを利用します。</span>
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">Gemini APIキー</span>
                  <input
                    type="password"
                    name="geminiApiKey"
                    placeholder="例: AIza..."
                    autocomplete="off"
                  />
                </label>
              </div>
            </section>
            <section class="admin__card admin__card--prompt" data-prompt-key="page1">
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">プロンプト</span>
                  <textarea
                    name="prompt_page1_prompt"
                    rows="6"
                    placeholder="生成時に利用する指示文を入力してください。"
                  ></textarea>
                </label>
              </div>
            </section>
          </section>
          <section class="admin__panel" data-tab-panel="landing">
            <section class="admin__card">
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">タイトル</span>
                  <input
                    type="text"
                    name="form1Title"
                    placeholder="体験の満足度を教えてください"
                    autocomplete="off"
                  />
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">リード文</span>
                  <textarea
                    name="form1Lead"
                    rows="3"
                    placeholder="星や選択式の設問に回答してください。内容は口コミ生成に活用されます。"
                  ></textarea>
                </label>
              </div>
            </section>
            <section class="admin__card admin__card--questions">
              <div class="admin__card-heading">
                <h2>設問</h2>
              </div>
              <p class="admin__hint">
                設問ごとに質問文や選択肢、回答形式（ドロップダウン / チェックボックス / テキスト入力 / 数字選択）を設定できます。
              </p>
              <div class="admin__question-list" data-role="form1-question-list"></div>
              <div class="admin__question-actions">
                <button type="button" class="admin__icon-button" data-role="form1-add-question">
                  <span aria-hidden="true">＋</span>
                  <span>設問を追加</span>
                </button>
              </div>
            </section>
          </section>
          <section class="admin__panel" data-tab-panel="links">
            <section class="admin__card">
              <h2>リンク先</h2>
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">URL</span>
                  <input type="url" name="mapsLink" placeholder="https://maps.app.goo.gl/..." autocomplete="off" />
                </label>
              </div>
            </section>
          </section>
          <section class="admin__panel" data-tab-panel="branding">
            <section class="admin__card">
              <h2>ロゴ設定</h2>
              <p class="admin__hint">アプリ全体で表示されるロゴ画像を差し替えます。</p>
              <div class="admin__brand">
                <div class="admin__brand-preview" aria-live="polite">
                  <img src="/vite.svg" alt="現在のロゴ" width="72" height="72" data-role="favicon-preview" />
                </div>
                <div class="admin__brand-actions">
                  <label class="admin__field admin__field--file">
                    <span class="admin__field-label">アイコン画像</span>
                    <input type="file" name="brandingLogo" accept="image/png,image/svg+xml,image/x-icon,image/*" />
                    <span class="admin__field-hint">100KB〜1MB程度の画像推奨です。</span>
                  </label>
                  <div class="admin__brand-buttons">
                    <button type="button" class="admin__text-button" data-role="favicon-remove">画像をリセット</button>
                  </div>
                  <input type="hidden" name="brandingLogoData" />
                </div>
              </div>
            </section>
            <section class="admin__card">
              <h2>ヘッダー画像</h2>
              <p class="admin__hint">各ページのヘッダーで表示する画像を設定します。</p>
              <div class="admin__brand admin__brand--header">
                <div class="admin__brand-preview admin__brand-preview--header" aria-live="polite">
                  <img
                    src=""
                    alt="現在のヘッダー画像"
                    width="160"
                    height="80"
                    data-role="header-image-preview"
                    hidden
                  />
                  <p class="admin__brand-placeholder" data-role="header-image-placeholder">
                    現在ヘッダー画像は未設定です。
                  </p>
                </div>
                <div class="admin__brand-actions">
                  <label class="admin__field admin__field--file">
                    <span class="admin__field-label">ヘッダー画像</span>
                    <input type="file" name="brandingHeaderImage" accept="image/png,image/jpeg,image/webp,image/svg+xml,image/*" />
                    <span class="admin__field-hint">横長の画像（最大2MB程度）を推奨します。</span>
                  </label>
                  <div class="admin__brand-buttons">
                    <button type="button" class="admin__text-button" data-role="header-image-remove">画像をリセット</button>
                  </div>
                  <input type="hidden" name="brandingHeaderImageData" />
                </div>
              </div>
            </section>
          </section>
          <section class="admin__panel" data-tab-panel="developer">
            <section class="admin__card">
              <h2>開発者モード</h2>
              <p class="admin__hint">ONにするとログイン認証とStripe連動を無効化し、デモ利用できます。</p>
              <div class="admin__fields admin__fields--single">
                <label class="admin__toggle">
                  <span class="admin__toggle-label">開発者モード</span>
                  <span class="admin__toggle-control">
                    <input type="checkbox" name="developerModeToggle" class="admin__toggle-input" />
                    <span class="admin__toggle-track">
                      <span class="admin__toggle-thumb"></span>
                    </span>
                    <span class="admin__toggle-status" data-role="developer-mode-status">OFF</span>
                  </span>
                </label>
              </div>
              <p class="admin__status admin__status--inline" data-role="developer-mode-message" hidden></p>
            </section>
          </section>
          <div class="admin__floating-submit">
            <button type="submit" class="admin__submit admin__submit--floating">設定を保存</button>
          </div>
        </form>
        <p class="admin__status" data-role="status"></p>
      </main>
    </div>
    <script type="module" src="../src/admin/main.js"></script>
  </body>
</html>
