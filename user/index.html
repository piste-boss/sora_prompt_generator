<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&family=Zen+Maru+Gothic:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../src/admin/style.css" />
    <script>
      ;(() => {
        const CACHE_KEY = 'oisoya_review_config_cache'
        const ensureLink = (rel) => {
          const existing = document.querySelector(`link[rel="${rel}"]`)
          if (existing) return existing
          const link = document.createElement('link')
          link.setAttribute('rel', rel)
          document.head.appendChild(link)
          return link
        }
        const applyIcon = (href) => {
          if (!href) return
          ensureLink('icon').setAttribute('href', href)
          ensureLink('shortcut icon').setAttribute('href', href)
          ensureLink('apple-touch-icon').setAttribute('href', href)
        }
        try {
          const raw = window.localStorage.getItem(CACHE_KEY)
          if (!raw) return
          const cached = JSON.parse(raw)
          const branding = cached?.branding || {}
          const icon = branding.logoDataUrl || branding.faviconDataUrl || ''
          if (icon) {
            applyIcon(icon)
          }
        } catch {
          // noop
        }
      })()
    </script>
    <title>ユーザー設定ページ</title>
  </head>
  <body>
    <div id="admin-app" data-app-role="user">
      <noscript>
        <p style="padding:1rem; text-align:center;">JavaScriptを有効にしてご利用ください。</p>
      </noscript>
      <main class="admin">
        <header class="admin__header">
          <p class="admin__badge">ユーザー設定ページ</p>
          <h1 class="admin__title">ユーザー設定</h1>
        </header>
        <div class="admin__menu" data-role="tab-menu-container">
          <button
            type="button"
            class="admin__menu-trigger"
            data-role="tab-menu-trigger"
            aria-expanded="false"
            aria-controls="user-tab-menu"
            aria-label="メニュー"
          >
            <span class="sr-only">メニュー</span>
            <span class="admin__menu-trigger-icon" aria-hidden="true">≡</span>
          </button>
          <div class="admin__menu-panel" id="user-tab-menu" data-role="tab-menu" aria-hidden="true">
            <nav class="admin__tabs" aria-label="設定メニュー">
              <button type="button" class="admin__tab is-active" data-tab-target="admin-settings">ユーザー情報</button>
              <button type="button" class="admin__tab" data-tab-target="reference-prompt">参考プロンプト</button>
            </nav>
          </div>
        </div>
        <form id="config-form" class="admin__form">
          <section class="admin__panel is-active" data-tab-panel="admin-settings">
            <section class="admin__card">
              <h2>ユーザー情報</h2>
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">名前</span>
                  <input type="text" name="profileAdminName" autocomplete="off" />
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">メールアドレス</span>
                  <input type="email" name="profileAdminEmail" autocomplete="off" />
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">パスワード</span>
                  <input type="password" name="profileAdminPassword" autocomplete="new-password" />
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">パスワード（確認）</span>
                  <input type="password" name="profileAdminPasswordConfirm" autocomplete="new-password" />
                </label>
              </div>
              <div class="admin__fields admin__fields--single">
                <label class="admin__toggle">
                  <span class="admin__toggle-label">パスワードを表示する</span>
                  <span class="admin__toggle-control">
                    <input type="checkbox" name="profileAdminPasswordToggle" class="admin__toggle-input" />
                    <span class="admin__toggle-track">
                      <span class="admin__toggle-thumb"></span>
                    </span>
                    <span class="admin__toggle-status" data-role="profile-admin-password-status">OFF</span>
                  </span>
                </label>
              </div>
              <div class="admin__profile-fetch">
                <button type="button" class="admin__button" data-role="profile-fetch">
                  保存済み情報を読み込む
                </button>
                <p class="admin__hint">登録済みのメールアドレスとパスワードを入力してから押してください。</p>
              </div>
              <section class="admin__card">
                <h2>プラン</h2>
                <p class="admin__hint">
                  Stripe Checkoutで有料プランに登録します。7日間の無料トライアルが適用されます。
                </p>
                <div class="admin__button-group">
                  <button type="button" class="admin__button" data-role="subscribe-basic">BASICを開始する</button>
                  <button
                    type="button"
                    class="admin__button admin__button--ghost"
                    data-role="subscribe-pro"
                    disabled
                    aria-disabled="true"
                    title="後日追加予定です"
                  >
                    PRO（後日追加予定）
                  </button>
                </div>
                <p class="admin__status admin__status--inline" data-role="billing-status"></p>
              </section>
            </section>
          </section>
          <section class="admin__panel" data-tab-panel="reference-prompt">
            <section class="admin__card admin__card--reference">
              <div class="reference-prompts" data-role="reference-prompts">
                <div class="reference-prompts__header">
                  <div class="reference-prompts__title">
                    <h2>参考プロンプト</h2>
                    <p class="reference-prompts__hint">
                      最大5件まで保存できます。タイトルをクリックして内容を確認・編集できます。
                    </p>
                  </div>
                  <button type="button" class="reference-prompts__add" data-role="reference-add">
                    ＋ 追加
                  </button>
                </div>
                <p class="reference-prompts__count" data-role="reference-count">0 / 5</p>
                <ul class="reference-prompts__list" data-role="reference-list"></ul>
                <p class="reference-prompts__empty" data-role="reference-empty">
                  保存された参考プロンプトはありません。
                </p>
              </div>
            </section>
          </section>
          <div class="admin__floating-submit">
            <button type="submit" class="admin__submit admin__submit--floating">設定を保存</button>
          </div>
        </form>
        <p class="admin__status" data-role="status"></p>
      </main>
      <div class="reference-modal" data-role="reference-modal" aria-hidden="true">
        <div class="reference-modal__overlay" data-role="reference-modal-overlay"></div>
        <div class="reference-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="reference-modal-title">
          <header class="reference-modal__header">
            <div>
              <p class="reference-modal__badge">参考プロンプトを編集</p>
              <h2 id="reference-modal-title">参考プロンプト</h2>
            </div>
            <button type="button" class="reference-modal__close" data-role="reference-modal-close" aria-label="閉じる">
              ✕
            </button>
          </header>
          <div class="reference-modal__content">
            <label class="reference-modal__field">
              <span>タイトル</span>
              <input type="text" data-role="reference-modal-title-input" placeholder="例：基本テンプレート" />
            </label>
            <label class="reference-modal__field">
              <span>プロンプト本文</span>
              <textarea
                rows="8"
                data-role="reference-modal-body-input"
                placeholder="AIに渡すプロンプト本文を入力"
              ></textarea>
            </label>
          </div>
          <div class="reference-modal__actions">
            <button type="button" class="reference-modal__delete" data-role="reference-modal-delete">削除</button>
            <div class="reference-modal__actions-right">
              <button type="button" class="reference-modal__cancel" data-role="reference-modal-cancel">キャンセル</button>
              <button type="button" class="reference-modal__save" data-role="reference-modal-save">保存</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="module" src="../src/admin/main.js"></script>
  </body>
</html>
